<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyppypeli</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        #gameCanvas {
            background-color: aqua;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const context = canvas.getContext("2d");

        // Asetetaan canvas-koon
        canvas.width = 567;
        canvas.height = 567;

        const characterImg = new Image();
        characterImg.src = 'char.png';

        const fenceImg = new Image();
        fenceImg.src = 'aita-80.png';

        const character = {
            x: 50,
            y: canvas.height - 90,
            width: 80,
            height: 80,
            color: "blue",
            jumping: false,
            jumpHeight: 100,
            jumpCount: 0
        };

        const fence = {
            x: 0,
            y: canvas.height - 30,
            width: canvas.width,
            height: 40,
            color: "brown"
        };

        const aita = {
            aidat: [
                { x: 50, korkeus: 60 },
                { x: 150, korkeus: 60 },
                // Lisää tarvittaessa muita aitaelementtejä
            ],
            leveys: 100, // Aidan leveys
            korkeus: 100,  // Aidan korkeus
            nopeus: 2 // Aidan liikkumisnopeus
        };

        let characterBehindFence = false;
         
        function drawCharacter() {
            //context.fillStyle = character.color;
            //context.fillRect(character.x, character.y, character.width, character.height);
            context.drawImage(characterImg, character.x, character.y, character.width, character.height);
        }

        function drawFence() {
            // context.fillStyle = fence.color;
            //context.fillRect(fence.x, fence.y, fence.width, fence.height);
            for (let i = 0; i < aita.aidat.length; i++) {
                context.drawImage(fenceImg, aita.aidat[i].x, canvas.height - aita.aidat[i].korkeus - 20, aita.leveys, aita.aidat[i].korkeus);
            }
        }

        function drawGame() {
            context.clearRect(0, 0, canvas.width, canvas.height);

            // Liikuta aitaa oikealta vasemmalle
            for (let i = 0; i < aita.aidat.length; i++) {
                aita.aidat[i].x -= aita.nopeus;

                // Tarkista, onko aitaelementti kokonaan näytön vasemman reunan ulkopuolella
                if (aita.aidat[i].x + aita.leveys <= 0) {
                    // Aseta aitaelementti takaisin näytön oikeaan reunaan
                    aita.aidat[i].x = canvas.width;
                }
            }

            // Piirretään ensin aita
            drawFence();

            // Päivitä hahmon sijaintia
            if (character.jumping) {
                character.y -= 5;
                character.jumpCount += 5;

                if (character.jumpCount >= character.jumpHeight) {
                    character.jumping = false;
                    character.jumpCount = 0;

                    // Kun hyppy päättyy, päätetään onko hahmo aidan takana vai edessä
                    characterBehindFence = !characterBehindFence;
                }
            } else if (character.y < canvas.height - character.height) {
                character.y += 5;
            }

            // Piirretään sitten hahmo aidan takana tai edessä
            if (characterBehindFence) {
                drawFence();  // Piirretään ensin aita
                drawCharacter();  // Piirretään sitten hahmo
            } else {
                drawCharacter();  // Piirretään ensin hahmo
                drawFence();  // Piirretään sitten aita
            }
        }

        function jump() {
            if (!character.jumping && character.y === canvas.height - character.height) {
                character.jumping = true;
            }
        }

        document.addEventListener("keydown", (event) => {
            if (event.key === " ") {
                jump();
            }
        });

        setInterval(drawGame, 1000 / 60);
    </script>
</body>
</html>
